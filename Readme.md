# Transaction Workflow Engine â€” Home Assignment

> **3 approaches** to the same backend assignment, each demonstrating a different level of architectural maturity using the XIIGen V17 "Freedom Machine" skill set.

---

## ğŸ“‚ Repository Structure

```text
sqlink-task/
â”œâ”€â”€ TransactionWorkflow_ApproachA.zip    # Vanilla .NET Clean Architecture
â”œâ”€â”€ TransactionWorkflow_ApproachB.zip    # DNA-Infused Multi-Tenant Engine
â”œâ”€â”€ TransactionWorkflow_ApproachD.zip    # Strategic Hybrid (â­ Recommended)
â”œâ”€â”€ buildAll.ps1                         # One-click extract + build all 3
â”œâ”€â”€ testAll.ps1                          # Full integration test suite (Docker + API)
â”œâ”€â”€ Backend_Home_Assignment.docx         # Original assignment brief
â”œâ”€â”€ Readme.md                            # â† You are here
â”‚
â”œâ”€â”€ approach_analysis.md                 # Deep analysis of all 4 approaches (A, B, C, D)
â”œâ”€â”€ approach_analysis.jsx                # Interactive React comparison UI
â”œâ”€â”€ approaches_comparison.md             # Side-by-side flow comparison (A vs B vs D)
â”œâ”€â”€ plan_diagram.mermaid                 # Visual phase dependency graph
â”‚
â”œâ”€â”€ FINAL_STATE.md                       # Phase 1â€“4 completion tracking
â”œâ”€â”€ IMPROVEMENT_PLAN.md                  # Phase 5â€“7 (R1â€“R7) improvement requirements
â”œâ”€â”€ INTEGRATION_FINAL_STATE.md           # V17 skill integration final status
â””â”€â”€ TEST_REPORT.md                       # Auto-generated by testAll.ps1
```

---

## ğŸš€ Quick Start â€” Build & Run All 3

### Prerequisites
- .NET 8 SDK
- Docker & Docker Compose (for running)
- PowerShell (for `buildAll.ps1`)

### One Command
```powershell
.\buildAll.ps1
```

This script extracts all 3 zips, applies known patches, and builds each solution. After build succeeds, run any approach:

```bash
cd TransactionWorkflow_ApproachD     # or A, or B
./start.sh                            # Linux / Mac / WSL
# â€” or â€”
docker-compose up --build -d          # Windows native
# â†’ Swagger UI: http://localhost:5000/swagger
# â†’ Health Check: http://localhost:5000/health
```

### Run Tests
```bash
# Unit tests (no Docker required)
cd TransactionWorkflow_ApproachD
dotnet test

# Full integration tests â€” all 3 approaches via Docker (from root)
.\testAll.ps1
```

---

## ğŸ—ï¸ The 3 Approaches

### Approach A â€” "Textbook Clean Architecture" (Vanilla)

The safe, expected solution. Classical .NET Clean Architecture with EF Core, domain exceptions, and service layer. No V17 patterns.

- **Engine:** Transaction-specific (`WorkflowEngine` knows about transactions)
- **Error handling:** Domain exceptions â†’ ProblemDetails middleware
- **Extensibility:** Adding "Orders" requires new code (engine + tables + service)
- **Best for:** Evaluators who want to see exactly what they asked for

### Approach B â€” "DNA-Infused Multi-Tenant Engine"

The platform play. Introduces an `EntityType` discriminator â€” one set of database tables manages workflows for **any entity type** simultaneously.

- **Engine:** Entity-agnostic (`TryTransitionAsync("transaction", ...)`)
- **Error handling:** `DataProcessResult<T>` â†’ `ResultMapper` â†’ ProblemDetails
- **Extensibility:** Adding "Orders" = SQL INSERT only, **zero code changes**
- **Best for:** Evaluators who value architectural vision and platform thinking

### Approach D â€” "Strategic Hybrid" â­ Recommended

The sweet spot. Looks like a standard .NET project on the outside, but uses Freedom Machine patterns on the inside. 80% of B's benefits with 20% of the complexity.

- **Engine:** Generic (depends only on `IWorkflowRepository`, not entity repos)
- **Error handling:** `DataProcessResult<T>` â†’ `ResultMapper` â†’ ProblemDetails
- **Extensibility:** JSON rules in DB for dynamic business logic, new adapter code for new entities
- **Best for:** Evaluators who want clean code PLUS evidence of deeper thinking

---

## ğŸ§ª The "Freedom Machine" Test

> *"Can a business user change the workflow without a developer?"*

| Capability | A | B | D |
|------------|---|---|---|
| Add new status | âœ… SQL INSERT | âœ… SQL INSERT (scoped by EntityType) | âœ… SQL INSERT |
| Add new entity type (e.g. Orders) | âŒ New code | âœ… **SQL only â€” zero code** | âŒ New adapter code |
| Add business rule (e.g. maxRetries) | âŒ C# change | âœ… JSON column + generic evaluator | âœ… JSON column + generic evaluator |
| Swap database provider | âŒ Coupled to EF | ğŸŸ¡ Behind interfaces | ğŸŸ¡ Behind interfaces |

---

## ğŸ› ï¸ V17 Skill Set Integration

Each approach maps to the XIIGen V17 skill library at a different depth:

| V17 Skill | Purpose | A | B | D |
|-----------|---------|---|---|---|
| **Skill 01** â€” Core Interfaces / DataProcessResult | Structured errors, no exceptions | âŒ Exceptions | âœ… Full | âœ… Full |
| **Skill 02** â€” Object Processor / JSON Rules | Dynamic business rules as data | âŒ | âœ… Full | âœ… Full |
| **Skill 05** â€” Database Fabric | Generic data access patterns | âœ… EF Core | âœ… EF Core + JSON | âœ… EF Core + JSON |
| **Skill 08** â€” Flow Definition | Workflow as data, not code | âœ… DB rows | âœ… EntityType-scoped | âœ… DB rows |
| **Skill 09** â€” Flow Orchestrator | State machine engine | âœ… Specific | âœ… Generic (multi-tenant) | âœ… Generic (single-tenant) |
| **Skill 15** â€” API Gateway | HTTP â†” domain mapping | âœ… Middleware | âœ… ResultMapper | âœ… ResultMapper |
| **Skill 29** â€” Testing | Automated quality assurance | âœ… xUnit | âœ… xUnit + isolation | âœ… xUnit |
| **Skill 45** â€” Design Patterns | Decorator, Adapter, Strategy | âœ… Decorator | âœ… All three | âœ… All three |

### The "Freedom Machine" Philosophy

The XIIGen V17 skill set is built around one principle: **if a business user might want to change it, it must be data, not code.**

- **MACHINE** = generic logic that never changes (the workflow engine, the result mapper, the repository interfaces)
- **FREEDOM** = configuration that business users control (statuses, transitions, rules â€” all in the database)

Approach A puts everything in the MACHINE. Approach B maximizes FREEDOM. Approach D finds the strategic balance.

---

## ğŸ“¡ API Endpoints (All Approaches)

### Core â€” Transactions

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/transactions` | Create a new transaction |
| `GET` | `/transactions/{id}` | Get transaction by ID |
| `POST` | `/transactions/{id}/transition` | Transition to a new status |
| `GET` | `/transactions/{id}/available-transitions` | List valid next statuses |
| `GET` | `/transactions/{id}/history` | Status change audit trail |

### Bonus â€” Admin Workflow Management

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/admin/workflow/statuses` | List all workflow statuses |
| `POST` | `/admin/workflow/statuses` | Add a new status |
| `GET` | `/admin/workflow/transitions` | List all transitions |
| `POST` | `/admin/workflow/transitions` | Add a new transition |
| `GET` | `/admin/workflow/visualize` | Mermaid.js workflow diagram |
| `GET` | `/health` | Health check with DB connectivity |

### Seeded Workflow
```
CREATED â†’ VALIDATED â†’ PROCESSING â†’ COMPLETED
                               â†˜ FAILED â†’ VALIDATED (retry)
```

---

## ğŸ“– Documentation Map

| Document | What It Covers |
|----------|---------------|
| [`approach_analysis.md`](approach_analysis.md) | Deep dive into all 4 approaches (A, B, C, D) with phase plans, V17 skill mapping, positive/negative examples, and recovery strategy |
| [`approaches_comparison.md`](approaches_comparison.md) | Side-by-side flow comparison: how Create Transaction and Execute Transition work differently in A vs B vs D |
| [`approach_analysis.jsx`](approach_analysis.jsx) | Interactive React component for visual approach comparison |
| [`plan_diagram.mermaid`](plan_diagram.mermaid) | Phase dependency graph (DevOps â†’ Validation â†’ API Quality â†’ Documentation) |
| [`IMPROVEMENT_PLAN.md`](IMPROVEMENT_PLAN.md) | Requirements R1â€“R7: engine purity, exception middleware, health checks, security, dependency fixes |
| [`FINAL_STATE.md`](FINAL_STATE.md) | Phase 1â€“4 completion: Docker healthchecks, FluentValidation, ProblemDetails, Mermaid visualization |
| [`INTEGRATION_FINAL_STATE.md`](INTEGRATION_FINAL_STATE.md) | V17 integration completion: AI configs, skill maps, code improvements across all 3 approaches |
| [`TEST_REPORT.md`](TEST_REPORT.md) | Auto-generated test results from `testAll.ps1` (33 tests across 3 approaches) |

---

## ğŸ”¨ buildAll.ps1 â€” What It Does

```
1. Extracts all 3 zips into folders
2. Patches B & D: moves a `using` statement from mid-file to top (cosmetic fix)
3. Runs `dotnet restore` + `dotnet build` for each approach
4. Reports build status with error highlighting
```

Expected output:
```
=== TransactionWorkflow_ApproachA ===
Build succeeded.    0 Warning(s)    0 Error(s)
BUILD OK

=== TransactionWorkflow_ApproachB ===
Build succeeded.    0 Warning(s)    0 Error(s)
BUILD OK

=== TransactionWorkflow_ApproachD ===
Build succeeded.    0 Warning(s)    0 Error(s)
BUILD OK
```

---

## ğŸ§ª testAll.ps1 â€” Full Integration Test Suite

Runs Docker-based end-to-end tests against all 3 approaches sequentially. For each approach it spins up containers, waits for the API, runs 11 tests, tears down, and moves to the next.

### Usage
```powershell
.\testAll.ps1
```

### What It Tests

| # | Test | Category | Validates |
|---|------|----------|-----------|
| T1 | Create Transaction | Happy Path | `POST /transactions` returns ID + CREATED status |
| T2 | Get Transaction | Happy Path | `GET /transactions/{id}` returns correct status |
| T3 | Available Transitions | Happy Path | CREATED â†’ VALIDATED is listed |
| T4 | Full Workflow | Happy Path | CREATED â†’ VALIDATED â†’ PROCESSING â†’ COMPLETED |
| T5 | Transaction History | Happy Path | At least 3 history entries after full workflow |
| T6 | Bad Input â†’ 400 | Error Path | Negative amount + invalid currency rejected |
| T7 | Invalid Transition â†’ 400 | Error Path | CREATED â†’ COMPLETED skipped, returns 400 |
| T8 | Not Found â†’ 404 | Error Path | Non-existent transaction ID returns 404 |
| T9 | Workflow Visualization | Features | `GET /admin/workflow/visualize` returns Mermaid graph |
| T10 | Admin: Get Statuses | Features | At least 4 seeded statuses returned |
| T11 | Admin: Get Transitions | Features | At least 4 seeded transitions returned |

### Test Flow Per Approach
```
Extract zip â†’ Patch Program.cs (B,D) â†’ docker-compose up â†’ Wait for API
â†’ Run 11 API tests â†’ docker-compose down â†’ Next approach
```

### Output
```
============================================================
  FINAL REPORT
============================================================

  Approach A (Vanilla)
  --------------------------------------------------
    [PASS] Docker Build
    [PASS] API Startup
    [PASS] Create Transaction
    ...

  TOTAL: 33 passed, 0 failed  |  Time: 8.2 minutes
============================================================
```

A `TEST_REPORT.md` is auto-generated with the full results table.

---

## â±ï¸ Time Investment

| Phase | Scope | Time |
|-------|-------|------|
| Initial build (A, B, D) | All 3 approaches from scratch | ~12h |
| Phase 1â€“4 | Docker, validation, ProblemDetails, Mermaid, READMEs | ~3h |
| Improvement Plan (R1â€“R7) | Engine purity, middleware, health, security, deps | ~2h |
| V17 Integration | AI configs, skill maps, cross-approach documentation | ~2h |
| **Total** | | **~19h** |
